{
  "entityType" : "RULE_CHAIN",
  "entity" : {
    "additionalInfo" : {
      "description" : ""
    },
    "configuration" : null,
    "debugMode" : false,
    "externalId" : {
      "entityType" : "RULE_CHAIN",
      "id" : "7dac4be0-1991-11ee-95b8-b71bbf0977f6"
    },
    "firstRuleNodeId" : {
      "entityType" : "RULE_NODE",
      "id" : "e4d7b7c0-1f3e-11ee-81c2-7319136e5604"
    },
    "id" : {
      "entityType" : "RULE_CHAIN",
      "id" : "7dac4be0-1991-11ee-95b8-b71bbf0977f6"
    },
    "name" : "PIR Sensor - Main",
    "root" : false,
    "type" : "CORE"
  },
  "metaData" : {
    "connections" : [ {
      "fromIndex" : 0,
      "toIndex" : 5,
      "type" : "Success"
    }, {
      "fromIndex" : 0,
      "toIndex" : 14,
      "type" : "Success"
    }, {
      "fromIndex" : 3,
      "toIndex" : 0,
      "type" : "Start"
    }, {
      "fromIndex" : 3,
      "toIndex" : 1,
      "type" : "Running"
    }, {
      "fromIndex" : 3,
      "toIndex" : 1,
      "type" : "Start"
    }, {
      "fromIndex" : 3,
      "toIndex" : 2,
      "type" : "Stop"
    }, {
      "fromIndex" : 4,
      "toIndex" : 6,
      "type" : "Success"
    }, {
      "fromIndex" : 5,
      "toIndex" : 4,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 7,
      "toIndex" : 8,
      "type" : "Failure"
    }, {
      "fromIndex" : 7,
      "toIndex" : 9,
      "type" : "Failure"
    }, {
      "fromIndex" : 8,
      "toIndex" : 3,
      "type" : "Success"
    }, {
      "fromIndex" : 9,
      "toIndex" : 10,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 11,
      "type" : "Success"
    }, {
      "fromIndex" : 10,
      "toIndex" : 12,
      "type" : "Failure"
    }, {
      "fromIndex" : 14,
      "toIndex" : 13,
      "type" : "Success"
    }, {
      "fromIndex" : 15,
      "toIndex" : 7,
      "type" : "Success"
    } ],
    "firstNodeIndex" : 15,
    "nodes" : [ {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 406,
        "layoutY" : 404
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return '\\nSIMULATION START!\\nmsg:' + JSON.stringify(msg) + ', metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nPIR SIMULATION STARTS\\n';"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db636f0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 567,
        "layoutY" : 258
      },
      "configuration" : {
        "ruleChainId" : "b19ccb80-214f-11ee-a0a8-91db501f381c"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db6fa40-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Loop",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.flow.TbRuleChainInputNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 581,
        "layoutY" : 132
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return \"\\n\\nSIMULATION STOPPED!\\n\\n\";",
        "tbelScript" : "return \"\\n\\nSIMULATION STOPPED!\\n\\n\";"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db7bd90-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 296,
        "layoutY" : 146
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "var simulationType = metadata.shared_simulation;\n\nif(simulationType == 'start') {\n    return ['Start'];\n}\nelse if(simulationType == \"stop\"){\n    return ['Stop'];\n}\nelse if(simulationType == \"running\"){\n    return ['Running'];\n}else{\n    return ['Nothing']\n}",
        "tbelScript" : "var simulationType = metadata.shared_simulation;\n\nif(simulationType == 'start') {\n    return ['start'];\n}\nelse if(simulationType == \"stop\"){\n    return ['stop'];\n}\nelse {\n    return ['running'];\n}"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db8a7f0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Switch",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.filter.TbJsSwitchNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 802,
        "layoutY" : 658
      },
      "configuration" : {
        "scope" : "SHARED_SCOPE",
        "notifyDevice" : false,
        "sendAttributesUpdatedNotification" : false,
        "updateAttributesOnlyOnValueChange" : false
      },
      "configurationVersion" : 2,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db91d20-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Save simulation attribute",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 565,
        "layoutY" : 553
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: {\n    \"simulation\": \"running\"\n}, metadata: metadata, msgType: \"POST_ATTRIBUTES_REQUEST\"};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7db9b960-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Simulation attribute change",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 987,
        "layoutY" : 533
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return '\\nSIMULATION RUNNING\\nmsg:' + JSON.stringify(msg) + ', metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nPIR SIMULATION STARTS\\n';"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbacad0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 29,
        "layoutY" : 322
      },
      "configuration" : {
        "tellFailureIfAbsent" : true,
        "clientAttributeNames" : [ ],
        "sharedAttributeNames" : [ "simulation" ],
        "serverAttributeNames" : [ ],
        "latestTsKeyNames" : [ "safe_status", "safe_last_presence", "presence", "presence_sensed", "last_presence_sensed" ],
        "getLatestValueWithTs" : false,
        "fetchTo" : "METADATA"
      },
      "configurationVersion" : 1,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbb4000-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Fetch latest telemetries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.metadata.TbGetAttributesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 195,
        "layoutY" : 459
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "if(metadata.presence == undefined) metadata.presence = 0;\nif(metadata.safe_status == undefined) metadata.safe_status = \"peace\";\nif(metadata.safe_last_presence == undefined) metadata.safe_last_presence = 0;\nif(metadata.presence_sensed == undefined) metadata.presence_sensed = 0;\nif(metadata.last_presence_sensed == undefined) metadata.last_presence_sensed = 0;\nreturn {msg: msg, metadata: metadata, msgType: msgType};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbc0350-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Default Telemetries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 56,
        "layoutY" : 594
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: {\n    presence: msg.presence == undefined ? 0 : msg.presence,\n    safe_status: msg.safe_status == undefined ? 0 : msg.safe_status,\n    safe_last_presence: msg.safe_last_presence == undefined ? 0 : msg.safe_last_presence,\n    presence_sensed: msg.presence_sensed == undefined ? 0 : msg.presence_sensed,\n    last_presence_sensed: msg.last_presence_sensed == undefined ? 0 : msg.last_presence_sensed,\n}, metadata: metadata, msgType: \"POST_TELEMETRY_REQUEST\"};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbcc6a0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Default Telemetries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 62,
        "layoutY" : 685
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbd62e0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Save default telemetries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 336,
        "layoutY" : 636
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return '\\n\\n\\n\\nDEFAULT TELEMETIRES SAVED!\\nmsg:' + JSON.stringify(msg) + ', metadata:\\n' + JSON.stringify(metadata);",
        "tbelScript" : "return '\\nPIR SIMULATION STARTS\\n';"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbe2630-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 321,
        "layoutY" : 747
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return '\\n\\n\\n\\nDEFAULT TELEMETIRES NOTNOTNOT SAVED!\\nmsg:' + JSON.stringify(msg) + ', metadata:\\n' + JSON.stringify(metadata)+\" , type:\"+msgType;",
        "tbelScript" : "return '\\nPIR SIMULATION STARTS\\n';"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbec270-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 943,
        "layoutY" : 399
      },
      "configuration" : {
        "defaultTTL" : 0,
        "skipLatestPersistence" : false,
        "useServerTs" : false
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dbf85c0-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Save default telemetries",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.telemetry.TbMsgTimeseriesNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 687,
        "layoutY" : 417
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return {msg: {\n    presence: metadata.presence_sensed\n}, metadata: metadata, msgType: \"POST_TELEMETRY_REQUEST\"};",
        "tbelScript" : "return {msg: msg, metadata: metadata, msgType: msgType};"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "7dc02200-1991-11ee-95b8-b71bbf0977f6"
      },
      "name" : "Update Presence",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.transform.TbTransformMsgNode"
    }, {
      "additionalInfo" : {
        "description" : "",
        "layoutX" : 226,
        "layoutY" : 47
      },
      "configuration" : {
        "scriptLang" : "JS",
        "jsScript" : "return '\\n\\n\\n\\nMAIN LOOP START!\\nmsg:' + JSON.stringify(msg) + ', metadata:\\n' + JSON.stringify(metadata)+\", msgType: \"+msgType;",
        "tbelScript" : "return '\\nPIR SIMULATION STARTS\\n';"
      },
      "configurationVersion" : 0,
      "createdTime" : 0,
      "debugMode" : false,
      "externalId" : null,
      "id" : {
        "entityType" : "RULE_NODE",
        "id" : "e4d7b7c0-1f3e-11ee-81c2-7319136e5604"
      },
      "name" : "Log",
      "queueName" : null,
      "ruleChainId" : null,
      "singletonMode" : false,
      "type" : "org.thingsboard.rule.engine.action.TbLogNode"
    } ],
    "ruleChainConnections" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}